pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

-- Game Loop

debug = false

function _init()
  -- enable mouse
  poke(0x5f2d, 1)

  local b = button
  b.box = {
    x_1 = b.x - 4,
    y_1 = b.y - 4,
    x_2 = b.x + 11,
    y_2 = b.y + 10
  }
end

function _update()
  cls(13)

  handle_input()

  open_lab_button()

  arcade_game_select()

  spr(0, m.x, m.y)
end

-->8
-- Input handling

mouse = {
  x = 0,
  y = 0
}

m = mouse
mouse_down = false
btn_left = false
btn_right = false

function handle_input()
  mouse_down = stat(34) == 1
      or stat(34) == 2

  -- get mouse x & y
  m.x = stat(32) - 1
  m.y = stat(33) - 1
end

-->8
-- Lab status updating

button_states = {
  up = 1,
  down = 2,
  up_on = 3,
  down_on = 4
}

button = {
  state = button_states.up,
  x = 56,
  y = 56,
  press_time = 0,
  cooldown = 0.75
}

is_depressed = false
is_toggled = false

#include lib/open_lab_remote.lua

function open_lab_button()
  local b = button.box

  ?"press button!", 36, 44, 0
  local now = time()
  if is_depressed then
    if now - button.press_time
        > button.cooldown then
      if is_toggled then
        button.state = button_states.up_on
      else
        button.state = button_states.up
      end
      is_depressed = false
    end
  end

  local in_box = m.x >= b.x_1 - 1
      and m.y >= b.y_1
      and m.x < b.x_2
      and m.y <= b.y_2

  local c = 1
  if in_box then
    c = 2
    if mouse_down
        and not is_depressed then
      is_depressed = true
      c = 7
      button.press_time = time()
      if is_toggled then
        button.state = button_states.down
        close_lab_remote()
        is_toggled = false
      else
        button.state = button_states.down_on
        open_lab_remote()
        is_toggled = true
      end
    end
  end

  -- draw button
  spr(
    button.state,
    button.x,
    button.y
  )

  if debug then
    rect(
      b.x_1,
      b.y_1,
      b.x_2,
      b.y_2,
      c
    )
  end
end

-->8
-- Arcade game selection

#include lib/arcade_games_config.lua

selected_arcade_game = 1

function arcade_game_select()
  if btn(0) then
    if not btn_left then
      selected_arcade_game = selected_arcade_game - 1
      if selected_arcade_game < 1 then
        selected_arcade_game = #arcade_games_list
      end
    end
    btn_left = true
  else
    btn_left = false
  end

  if btn(1) then
    if not btn_right then
      selected_arcade_game = selected_arcade_game + 1
      if selected_arcade_game > #arcade_games_list then
        selected_arcade_game = 1
      end
    end
    btn_right = true
  else
    btn_right = false
  end

  local selected_game = arcade_games_list[selected_arcade_game]

  ?selected_game, 43, 5, 0
  if btn(4) then
    load(arcade_games_path .. selected_game .. ".p8", "exit arcade")
  end
end

__gfx__
0010000008888880000000000bbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
017100008888888800000000bbbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
017710008888888808888880bbbbbbbb0bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0177710078888888888888887bbbbbbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01777710277778828888888837777bb3bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
017711002222222278888888333333337bbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0011710002222220077778800333333007777bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00288888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0128ccc7777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0128cccccc7800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0228cccccc7800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0228ccccccc800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0128ccccccc800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01288888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01281111111800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01181171771800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01128161167180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01228111111180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01228888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01282222222800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01282222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01211111222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01211111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000606100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f3f3f3f3f3f3f3f70713f3f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040404040404040404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f3f3f3f3f3f3f3f3f3f00001700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f3f3f3f3f3f3f3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f173f17173f3f3f3f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000001919170000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
